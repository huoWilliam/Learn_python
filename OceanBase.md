# 第一章 分布式数据库与集中式数据库的差异

## 传统数据库

随着云计算和大数据时代的到来，业务流量和数据量成井喷式发展，对数据库的要求越来越高，传统数据面临许多挑战。

1. 他们普遍采用了基于单点高端硬件的架构，对硬件的要求很高，部署的成本也很高。后期维护这些高端硬件需要耗费大量的精力。
2. 随着业务量的增大，他们只能纵向扩展（扩展CPU，内存等，达到上限后再更换主机），无法横向扩展。
3. 传统数据库虽然能很好地应对高并发查询的场景，但一旦碰到需要访问的并发量太大（比如11.11期间，短期的洪峰流量突破了单点设备所能提供的存储容量上限或计算能力的上限），剧烈的资源争抢，就会导致整体性能的显著下降。因此传统数据库比较适合处理并发量和数据量比较平稳和有限的场景。

为了解决上述问题，同时也为了降低成本，传统数据库普遍引入了分库分表，中间件的方案。比如Mysql数据库常用的mycat中间件，利用中间件将多个单点的数据库整合在一起，来实现水平扩展，但从架构上来讲，各个数据库之间还是相互独立的，他们相互之间感知不到对方。要进行跨库事务的时候，必须依赖中间件。该方案虽然暂时解决了扩展性的问题，而且技术难度和成本相对较低，不需要修改数据库的引擎。但是它有引入了一些其他的问题：

1. 应用侵入性：为了满足中间件的使用要求，应用必须做相应的改造，来实现正确的数据访问路由，这对应用有很大的侵入性，相当于把数据库没解决的问题甩给了应用。应用开发需要做改造来适配。每次扩容，缩容时，由于底层数据库引擎不能在线调整数据分布规则，就需要暂停业务，重新导入数据，做一次相应的路由变更。这回加大应用开发和运维的复杂度。
2. 带来了诸多功能的限制：如果应用比较简单，单表的规模也不大，所有操作都可以在一个单点数据库完成，对功能是不会有太多的限制。但只要一些操作需要跨越不同的数据库，比如做多表关联的复杂SQL，由于中间件不具备分布式并行计算的能力，就导致它不能跨越多台机器来协同的执行任务。所以很多的数据库中间件会告诉应用开发者一些它不支持的SQL，需要应用通过其他方式来解决。这影响了整个应用的迁移和开发。
3. 难以保证数据的一致性：比如当一个事务中处理的数据需要跨越多个不同的单点数据库时，由于数据库引擎没有分布式的能力，只能通过中间件来完成分布式的处理，中间件无法保证多台机器之间的数据一致性。尤其是中间件执行分布式事务过程中，遇到异常的时候，更无法保证分布式事务的ACID。

造成这些问题的原因是这种架构的先天不足，分布式，扩展性等关键能力没有内嵌在数据库引擎里面，而是在数据库之外的中间件层面来实现，因此当某些操作要求底层数据库具备这些能力时，中间件就显得无能为力。

## 分布式数据库

原生的分布式是把中间件的工作下移到数据库引擎中，一般采用多副本一致性的架构。

对应用而言，应用依然可以像使用传统集中式数据库一样，继续使用分布式数据库。业务不需要关心其底层的分布式架构，迁移改造成本较低。

1. 如何解决传统数据库的高成本和扩展性问题？

   分布式数据库可以使用普通的PC服务器，可以方便地在市场上买到。服务器自身无需外挂高端存储，也可以不使用RAID等技术，所以原生分布式数据库在硬件上可以摆脱对小型机，高端存储等高价格产品的依赖。随着业务扩展，当需要扩容时，只需要将新的服务器加入数据库集群中，集群会自动地将部分数据迁移到新的机器。之后系统自动将流量切到新的服务器上，整个过程对业务是透明的。缩容时，只需要将服务器移除集群，系统会自动做反向操作，该过程对应用也是透明的。

